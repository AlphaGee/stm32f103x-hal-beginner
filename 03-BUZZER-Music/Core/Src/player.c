#include "stm32f1xx_hal.h"
#include "note.h"
#include "player.h"

// 兰花草
const Note lanhuacao[] = {
    {57, 8, 0}, {64, 8, 0}, {64, 8, 0}, {64, 8, 0}, {64, 4, 1}, {62, 8, 0}, {60, 8, 1}, {62, 16, 0}, {60, 8, 0}, {59, 8, 0}, {57, 2, 0}, {69, 8, 0}, {69, 8, 0}, {69, 8, 0}, {69, 8, 0}, {69, 4, 1}, {67, 8, 0}, {64, 8, 0}, {67, 8, 0}, {67, 8, 0}, {66, 8, 0}, {64, 2, 0}, {64, 8, 0}, {69, 8, 0}, {69, 8, 0}, {67, 8, 0}, {64, 4, 1}, {62, 8, 0}, {60, 8, 1}, {62, 16, 0}, {60, 8, 0}, {59, 8, 0}, {57, 4, 0}, {52, 4, 0}, {52, 8, 0}, {60, 8, 0}, {60, 8, 0}, {59, 8, 0}, {57, 4, 1}, {52, 8, 0}, {62, 8, 1}, {60, 16, 0}, {59, 8, 0}, {55, 8, 0}, {57, 2, 0}};

// 鲜烈之龙
const Note senretsu_no_ryu[] = {
    {66, 8, 0}, {81, 8, 0}, {66, 8, 0}, {83, 8, 0}, {64, 16, 0}, {66, 8, 0}, {64, 16, 0}, {66, 8, 0}, {73, 8, 0}, {66, 16, 0}, {66, 16, 0}, {66, 16, 0}, {66, 16, 0}, {66, 8, 0}, {68, 8, 0}, {81, 8, 0}, {68, 8, 0}, {66, 4, 0}, {68, 8, 0}, {66, 8, 0}, {83, 8, 0}, {68, 8, 0}, {66, 16, 0}, {68, 8, 0}, {66, 16, 0}, {68, 8, 0}, {73, 8, 0}, {68, 16, 0}, {68, 16, 0}, {68, 16, 0}, {68, 16, 0}, {68, 8, 0}, {81, 8, 0}, {83, 8, 0}, {81, 8, 0}, {68, 4, 0}};

// 英雄之证
const Note proof_of_a_hero[] = {
    {69, 8, 1}, {64, 16, 0}, {69, 8, 0}, {71, 4, 1}, {71, 8, 0}, {64, 8, 0}, {69, 8, 0}, {71, 8, 0}, {69, 8, 0}, {64, 8, 0}, {76, 4, 1}, {76, 8, 0}, {74, 8, 0}, {72, 8, 0}, {71, 4, 1}, {67, 4, 1}, {69, 8, 0}, {71, 8, 0}, {72, 8, 0}, {72, 8, 0}, {71, 8, 0}, {69, 8, 0}, {71, 4, 1}, {67, 4, 1}, {64, 2, 1}, {128, 4, 1}, {69, 8, 1}, {64, 16, 0}, {69, 8, 0}, {71, 4, 1}, {71, 8, 0}, {64, 8, 0}, {69, 8, 0}, {71, 8, 0}, {69, 8, 0}, {64, 8, 0}, {69, 4, 1}, {69, 8, 0}, {67, 8, 0}, {65, 8, 0}, {64, 2, 1}, {62, 8, 0}, {64, 8, 0}, {65, 8, 0}, {65, 8, 0}, {64, 8, 0}, {65, 8, 0}, {67, 4, 1}, {71, 4, 1}, {69, 2, 1}};

Melody song3 = {
    .name = "兰花草",
    .bpm = 120,
    .notes = lanhuacao,
    .length = sizeof(lanhuacao) / sizeof(lanhuacao[0])};

Melody song2 = {
    .name = "鲜烈之龙",
    .bpm = 150,
    .notes = senretsu_no_ryu,
    .length = sizeof(senretsu_no_ryu) / sizeof(senretsu_no_ryu[0])};

Melody song1 = {
    .name = "英雄之证",
    .bpm = 120,
    .notes = proof_of_a_hero,
    .length = sizeof(proof_of_a_hero) / sizeof(proof_of_a_hero[0])};

// 播放歌曲
void melody(TIM_HandleTypeDef *htim, uint32_t Channel, uint16_t length, uint16_t bpm, const Note *song)
{

    for (uint16_t i = 0; i < length; i++)
    {
        note(htim, Channel, bpm, song[i]);
        __HAL_TIM_SET_COMPARE(htim, Channel, 0);
        HAL_Delay(10);
    }
    __HAL_TIM_SET_COMPARE(htim, Channel, 0);
}